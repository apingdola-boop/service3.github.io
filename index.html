<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöó Í±∞Î¶¨ & Ïú†Î•òÎπÑ Í≥ÑÏÇ∞Í∏∞</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-gradient-1: #0f0c29;
            --bg-gradient-2: #302b63;
            --bg-gradient-3: #24243e;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
            --accent-cyan: #00d4ff;
            --accent-magenta: #ff00d4;
            --accent-yellow: #ffd700;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --success-green: #00ff88;
            --error-red: #ff4757;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--bg-gradient-1) 0%, var(--bg-gradient-2) 50%, var(--bg-gradient-3) 100%);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            top: -50%;
            left: -50%;
            background: radial-gradient(circle at 20% 80%, rgba(0, 212, 255, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 0, 212, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.1) 0%, transparent 50%);
            animation: bgRotate 30s linear infinite;
        }

        @keyframes bgRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta), var(--accent-yellow));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease infinite;
            margin-bottom: 10px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% center; }
            50% { background-position: 100% center; }
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 300;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            animation: fadeInUp 0.8s ease-out;
            animation-fill-mode: backwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title .icon { font-size: 1.5rem; }

        .input-group { margin-bottom: 20px; }

        .input-group label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .input-group input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        .input-group input::placeholder { color: rgba(255, 255, 255, 0.3); }

        .waypoint-container { margin: 20px 0; }

        .waypoint-item {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            animation: fadeInUp 0.3s ease-out;
        }

        .waypoint-item input {
            flex: 1;
            padding: 15px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            font-family: inherit;
        }

        .waypoint-item input:focus {
            outline: none;
            border-color: var(--accent-yellow);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .btn-remove-waypoint {
            padding: 15px;
            background: rgba(255, 71, 87, 0.2);
            border: 1px solid var(--error-red);
            border-radius: 12px;
            color: var(--error-red);
            font-size: 1.2rem;
            cursor: pointer;
            min-width: 50px;
        }

        .btn-remove-waypoint:hover { background: rgba(255, 71, 87, 0.4); }

        .btn-add-waypoint {
            width: 100%;
            padding: 12px 20px;
            background: rgba(255, 215, 0, 0.1);
            border: 1px dashed var(--accent-yellow);
            border-radius: 12px;
            color: var(--accent-yellow);
            font-size: 0.95rem;
            font-family: inherit;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-add-waypoint:hover { background: rgba(255, 215, 0, 0.2); }

        .btn {
            width: 100%;
            padding: 18px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.4);
        }

        .btn:disabled { opacity: 0.6; cursor: not-allowed; }

        .btn .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 10px;
        }

        .btn.loading .spinner { display: inline-block; }

        @keyframes spin { to { transform: rotate(360deg); } }

        .results { display: none; }
        .results.show { display: block; animation: fadeInUp 0.5s ease-out; }

        .result-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--card-border);
        }

        .route-flow {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
        }

        .route-point {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.95rem;
        }

        .route-point.start { background: rgba(0, 212, 255, 0.2); border: 1px solid var(--accent-cyan); }
        .route-point.end { background: rgba(255, 0, 212, 0.2); border: 1px solid var(--accent-magenta); }
        .route-point.waypoint { background: rgba(255, 215, 0, 0.2); border: 1px solid var(--accent-yellow); }

        .route-arrow { color: var(--accent-cyan); font-size: 1.2rem; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        @media (max-width: 500px) { .stats-grid { grid-template-columns: 1fr; } }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover { transform: translateY(-5px); }

        .stat-card.highlight {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(255, 0, 212, 0.2));
            grid-column: span 2;
        }

        @media (max-width: 500px) { .stat-card.highlight { grid-column: span 1; } }

        .stat-icon { font-size: 2rem; margin-bottom: 10px; }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-cyan);
            margin-bottom: 5px;
        }

        .stat-card.highlight .stat-value {
            font-size: 2.2rem;
            background: linear-gradient(90deg, var(--accent-cyan), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label { font-size: 0.85rem; color: var(--text-secondary); }

        .error-message {
            display: none;
            background: rgba(255, 71, 87, 0.15);
            border: 1px solid var(--error-red);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 20px;
            color: var(--error-red);
        }

        .error-message.show { display: flex; align-items: center; gap: 10px; }

        .kakao-link {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 24px;
            background: #FEE500;
            color: #000;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .kakao-link:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(254, 229, 0, 0.4); }

        .info-note {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: var(--success-green);
        }

        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        footer a { color: var(--accent-cyan); text-decoration: none; }
    </style>
</head>
<body>
    <div class="bg-animation"></div>
    
    <div class="container">
        <header>
            <h1 class="logo">üöó ROUTE CALC</h1>
            <p class="subtitle">Ïπ¥Ïπ¥Ïò§ API Í∏∞Î∞ò Ïã§Ï†ú Í≤ΩÎ°ú Í±∞Î¶¨ & Ïú†Î•òÎπÑ Í≥ÑÏÇ∞Í∏∞</p>
        </header>

        <div class="card">
            <h2 class="card-title"><span class="icon">üìç</span> Í≤ΩÎ°ú ÏÑ§Ï†ï</h2>
            <div class="input-group">
                <label for="start">Ï∂úÎ∞úÏßÄ</label>
                <input type="text" id="start" placeholder="Ïòà: ÏÑúÏö∏ÏãúÏ≤≠, Í∞ïÎÇ®Ïó≠, Î∂ÄÏÇ∞ Ìï¥Ïö¥ÎåÄÍµ¨">
            </div>

            <div class="waypoint-container" id="waypoint-container"></div>
            
            <button class="btn-add-waypoint" onclick="addWaypoint()">
                <span>‚ûï</span> Í≤ΩÏú†ÏßÄ Ï∂îÍ∞Ä
            </button>

            <div class="input-group" style="margin-top: 20px;">
                <label for="end">ÎèÑÏ∞©ÏßÄ</label>
                <input type="text" id="end" placeholder="Ïòà: Ïù∏Ï≤úÍ≥µÌï≠, ÎåÄÏ†ÑÏó≠, Ï†úÏ£ºÏãú">
            </div>
        </div>

        <div class="card">
            <h2 class="card-title"><span class="icon">‚õΩ</span> Ïú†Î•òÎπÑ ÏÑ§Ï†ï</h2>
            <div class="input-group">
                <label for="cost_per_km">kmÎãπ ÎπÑÏö© (Ïõê/km)</label>
                <input type="number" id="cost_per_km" value="150" min="50" max="500" step="10">
                <p style="margin-top: 8px; font-size: 0.85rem; color: var(--text-secondary);">
                    üí° ÏùºÎ∞òÏ†ÅÏúºÎ°ú 100~200Ïõê/km (ÌúòÎ∞úÏú† Í∏∞Ï§Ä ÏïΩ 130~170Ïõê/km)
                </p>
            </div>
        </div>

        <div class="error-message" id="error">
            <span>‚ö†Ô∏è</span>
            <span id="error-text"></span>
        </div>

        <button class="btn btn-primary" id="calculate-btn" onclick="calculate()">
            <span class="spinner"></span>
            <span class="btn-text">Í±∞Î¶¨ & Ïú†Î•òÎπÑ Í≥ÑÏÇ∞ÌïòÍ∏∞</span>
        </button>

        <div class="results" id="results">
            <div class="card">
                <div class="result-header">
                    <div class="route-flow" id="route-flow"></div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üõ£Ô∏è</div>
                        <div class="stat-value" id="result-distance">-</div>
                        <div class="stat-label">Ïã§Ï†ú ÎèÑÎ°ú Í±∞Î¶¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-value" id="result-duration">-</div>
                        <div class="stat-label">ÏòàÏÉÅ ÏÜåÏöîÏãúÍ∞Ñ</div>
                    </div>
                    <div class="stat-card highlight">
                        <div class="stat-icon">üí∞</div>
                        <div class="stat-value" id="result-total">-</div>
                        <div class="stat-label">ÏòàÏÉÅ Ïú†Î•òÎπÑ</div>
                    </div>
                </div>

                <div style="text-align: center;">
                    <a class="kakao-link" id="kakao-navi-link" href="#" target="_blank">
                        üó∫Ô∏è Ïπ¥Ïπ¥Ïò§ÎßµÏóêÏÑú Í≤ΩÎ°ú Î≥¥Í∏∞
                    </a>
                </div>

                <div class="info-note">
                    ‚úÖ Ïã§Ï†ú ÎèÑÎ°ú Í≤ΩÎ°ú Í∏∞Î∞òÏùò Ï†ïÌôïÌïú Í±∞Î¶¨ÏûÖÎãàÎã§!
                </div>
            </div>
        </div>

        <footer>
            <p>Powered by <a href="https://developers.kakao.com/" target="_blank">Kakao Mobility API</a></p>
        </footer>
    </div>

    <script>
        // Ïπ¥Ïπ¥Ïò§ REST API ÌÇ§
        const KAKAO_REST_API_KEY = '90002fe2ca1129c4281d84a37e00eb43';
        
        let waypointCount = 0;

        // Í≤ΩÏú†ÏßÄ Ï∂îÍ∞Ä
        function addWaypoint() {
            waypointCount++;
            const container = document.getElementById('waypoint-container');
            const div = document.createElement('div');
            div.className = 'waypoint-item';
            div.id = `waypoint-${waypointCount}`;
            div.innerHTML = `
                <input type="text" placeholder="Í≤ΩÏú†ÏßÄ ${waypointCount}" class="waypoint-input">
                <button class="btn-remove-waypoint" onclick="removeWaypoint(${waypointCount})">‚úï</button>
            `;
            container.appendChild(div);
        }

        // Í≤ΩÏú†ÏßÄ ÏÇ≠Ï†ú
        function removeWaypoint(id) {
            document.getElementById(`waypoint-${id}`)?.remove();
        }

        // Î™®Îì† Í≤ΩÏú†ÏßÄ Í∞ÄÏ†∏Ïò§Í∏∞
        function getWaypoints() {
            return Array.from(document.querySelectorAll('.waypoint-input'))
                .map(input => input.value.trim())
                .filter(v => v);
        }

        // Ïπ¥Ïπ¥Ïò§ REST APIÎ°ú Ï£ºÏÜå Í≤ÄÏÉâ
        async function searchAddress(query) {
            const url = `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(query)}`;
            const response = await fetch(url, {
                headers: { 'Authorization': `KakaoAK ${KAKAO_REST_API_KEY}` }
            });
            
            if (!response.ok) {
                throw new Error(`Ï£ºÏÜå Í≤ÄÏÉâ Ïã§Ìå®: ${query}`);
            }
            
            const data = await response.json();
            if (data.documents && data.documents.length > 0) {
                const place = data.documents[0];
                return {
                    name: place.place_name,
                    x: place.x,
                    y: place.y
                };
            }
            throw new Error(`Ï£ºÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§: ${query}`);
        }

        // Ïπ¥Ïπ¥Ïò§ Î™®ÎπåÎ¶¨Ìã∞ APIÎ°ú Í≤ΩÎ°ú ÌÉêÏÉâ
        async function getRoute(origin, destination, waypoints = []) {
            let url = `https://apis-navi.kakaomobility.com/v1/directions?origin=${origin.x},${origin.y}&destination=${destination.x},${destination.y}`;
            
            if (waypoints.length > 0) {
                const waypointStr = waypoints.map(w => `${w.x},${w.y}`).join('|');
                url += `&waypoints=${waypointStr}`;
            }
            
            const response = await fetch(url, {
                headers: { 'Authorization': `KakaoAK ${KAKAO_REST_API_KEY}` }
            });
            
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({}));
                throw new Error(errorData.message || 'Í≤ΩÎ°ú ÌÉêÏÉâ Ïã§Ìå®');
            }
            
            const data = await response.json();
            
            if (data.routes && data.routes.length > 0 && data.routes[0].result_code === 0) {
                const route = data.routes[0];
                return {
                    distance: route.summary.distance, // ÎØ∏ÌÑ∞
                    duration: route.summary.duration  // Ï¥à
                };
            }
            
            throw new Error('Í≤ΩÎ°úÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        }

        // ÏãúÍ∞Ñ Ìè¨Îß∑ÌåÖ
        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (hours > 0) {
                return `${hours}ÏãúÍ∞Ñ ${minutes}Î∂Ñ`;
            }
            return `${minutes}Î∂Ñ`;
        }

        // Í≥ÑÏÇ∞ Ïã§Ìñâ
        async function calculate() {
            const btn = document.getElementById('calculate-btn');
            const errorEl = document.getElementById('error');
            const resultsEl = document.getElementById('results');
            
            const startInput = document.getElementById('start').value.trim();
            const endInput = document.getElementById('end').value.trim();
            const waypoints = getWaypoints();
            const costPerKm = parseFloat(document.getElementById('cost_per_km').value) || 150;

            if (!startInput || !endInput) {
                showError('Ï∂úÎ∞úÏßÄÏôÄ ÎèÑÏ∞©ÏßÄÎ•º Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            btn.classList.add('loading');
            btn.disabled = true;
            errorEl.classList.remove('show');
            resultsEl.classList.remove('show');

            try {
                // Î™®Îì† Ï£ºÏÜå Í≤ÄÏÉâ
                const allAddresses = [startInput, ...waypoints, endInput];
                const coords = await Promise.all(allAddresses.map(addr => searchAddress(addr)));
                
                // Í≤ΩÎ°ú ÌÉêÏÉâ
                const origin = coords[0];
                const destination = coords[coords.length - 1];
                const waypointCoords = coords.slice(1, -1);
                
                const route = await getRoute(origin, destination, waypointCoords);
                
                // Í±∞Î¶¨ (ÎØ∏ÌÑ∞ ‚Üí km)
                const distanceKm = route.distance / 1000;
                
                // Ïú†Î•òÎπÑ Í≥ÑÏÇ∞
                const totalCost = distanceKm * costPerKm;

                // Í≤ΩÎ°ú ÌëúÏãú
                const routeFlow = document.getElementById('route-flow');
                routeFlow.innerHTML = '';
                
                coords.forEach((coord, index) => {
                    if (index > 0) {
                        routeFlow.innerHTML += '<span class="route-arrow">‚Üí</span>';
                    }
                    
                    let pointClass = 'route-point';
                    if (index === 0) pointClass += ' start';
                    else if (index === coords.length - 1) pointClass += ' end';
                    else pointClass += ' waypoint';
                    
                    routeFlow.innerHTML += `<span class="${pointClass}">${coord.name}</span>`;
                });

                // Í≤∞Í≥º ÌëúÏãú
                document.getElementById('result-distance').textContent = distanceKm.toFixed(1) + ' km';
                document.getElementById('result-duration').textContent = formatDuration(route.duration);
                document.getElementById('result-total').textContent = Math.round(totalCost).toLocaleString() + ' Ïõê';

                // Ïπ¥Ïπ¥Ïò§Îßµ Í∏∏Ï∞æÍ∏∞ ÎßÅÌÅ¨
                const kakaoNaviUrl = `https://map.kakao.com/?sName=${encodeURIComponent(startInput)}&eName=${encodeURIComponent(endInput)}`;
                document.getElementById('kakao-navi-link').href = kakaoNaviUrl;

                resultsEl.classList.add('show');
                resultsEl.scrollIntoView({ behavior: 'smooth', block: 'start' });

            } catch (error) {
                console.error('Error:', error);
                showError(error.message);
            } finally {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('error');
            document.getElementById('error-text').textContent = message;
            errorEl.classList.add('show');
        }

        // ÏóîÌÑ∞ÌÇ§Î°ú Í≤ÄÏÉâ
        document.getElementById('start').addEventListener('keypress', e => {
            if (e.key === 'Enter') document.getElementById('end').focus();
        });

        document.getElementById('end').addEventListener('keypress', e => {
            if (e.key === 'Enter') calculate();
        });
    </script>
</body>
</html>
